define("repository_zatuk/configuration",["exports","jquery","core/ajax","core/str","repository_zatuk/messagemodal","core/templates"],(function(_exports,_jquery,_ajax,_str,_messagemodal,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Defines zatuk configuration script.
   *
   * @copyright  2023 Moodle India
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_messagemodal=_interopRequireDefault(_messagemodal),_templates=_interopRequireDefault(_templates);const Selectors_actions={zatuksettings:'[data-action="zatuksettings"]',zatukplans:'[data-action="zatukplans"]',zatukdetails:'[data-action="zatukdetails"]',updatesettings:'[data-action="updatesettings"]'};let MessageModal=new _messagemodal.default;_exports.init=()=>{function isValidEmail(inputval){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(inputval)}document.addEventListener("click",(function(e){if(e.target.closest(Selectors_actions.zatuksettings)){let organization=(0,_jquery.default)("#id_organization").val(),organizationcode=(0,_jquery.default)("#id_organization_code").val(),name=(0,_jquery.default)("#id_name").val(),email=(0,_jquery.default)("#id_email").val();e.preventDefault(),""===organization||""===organizationcode||""===name||""===email?(0,_str.get_string)("requiredallfields","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))})):isValidEmail(email)?_jquery.default.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/repository/zatuk/ajax.php?organization="+organization+"&organizationcode="+organizationcode+"&name="+name+"&email="+email,success:function(){(0,_jquery.default)(".section_container").addClass("d-none"),(0,_jquery.default)(".section_container.registration_plans").removeClass("d-none"),(0,_jquery.default)(".step-1").addClass("completed"),(0,_jquery.default)(".step-2").addClass("active")}}):(0,_str.get_string)("validemailidrequired","repository_zatuk",email).then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}})),document.addEventListener("click",(function(e){if(e.target.closest(Selectors_actions.zatukplans)){e.preventDefault(),_templates.default.render("repository_zatuk/loader",{}).then((function(html,js){_templates.default.appendNodeContents("#page-content",html,js)}));var organization=(0,_jquery.default)("#id_organization").val(),organizationcode=(0,_jquery.default)("#id_organization_code").val(),name=(0,_jquery.default)("#id_name").val(),email=(0,_jquery.default)("#id_email").val(),params={};params.organization=organization,params.organizationcode=organizationcode,params.name=name,params.email=email,_ajax.default.call([{methodname:"repository_configure_zatuk",args:params}])[0].done((function(resp){if(resp.success){var params={};params.haskeygenerated=resp.success,_ajax.default.call([{methodname:"repository_enable_zatuk",args:params}])[0].done((function(enbresponse){enbresponse.success?((0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),(0,_str.get_string)("freetrailmessage","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("finaltrailmessage","repository_zatuk",str))})),(0,_jquery.default)(".secret_keys").load(location.href+" .secret_keys"),(0,_jquery.default)(".section_container").addClass("d-none"),(0,_jquery.default)(".section_container.registration_keys").removeClass("d-none"),(0,_jquery.default)(".step-2").addClass("completed"),(0,_jquery.default)(".step-3").addClass("active")):((0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),(0,_str.get_string)("keysecretnotgenerated","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))})))})).fail((function(){(0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),(0,_str.get_string)("errormessage","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}))}else resp.message.length>2?((0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",resp.message))):((0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),(0,_str.get_string)("serverdown","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))})))})).fail((function(){(0,_jquery.default)(".zatuk-page-loader").addClass("d-none"),(0,_str.get_string)("errormessage","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}))}})),document.addEventListener("click",(function(e){e.target.closest(Selectors_actions.zatukdetails)&&(window.addEventListener("beforeunload",(function(event){event.stopImmediatePropagation()})),window.location.reload())})),document.addEventListener("click",(function(e){if(e.target.closest(Selectors_actions.updatesettings)){e.preventDefault();var params={},organization=(0,_jquery.default)("#id_organization").val(),name=(0,_jquery.default)("#id_name").val(),email=(0,_jquery.default)("#id_email").val();if(""===organization||""===name||""===email)(0,_str.get_string)("requiredallfields","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}));else if(isValidEmail(email))(params={}).organization=organization,params.name=name,params.email=email,_ajax.default.call([{methodname:"repository_update_zatuk_settings",args:params}])[0].done((function(resp){resp.success&&(0,_str.get_string)("updatemessage","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("finaltrailmessage","repository_zatuk",str))}))})).fail((function(){(0,_str.get_string)("errormessage","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}));else(0,_str.get_string)("validemailidrequired","repository_zatuk",email).then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}})),(0,_jquery.default)(document).on("click",".stage-a",(function(){(0,_jquery.default)(".section_container").removeClass("d-none"),(0,_jquery.default)(".section_container.registration_plans").addClass("d-none"),(0,_jquery.default)(".section_container.registration_keys").addClass("d-none"),(0,_jquery.default)(".stage-form .section_container").addClass("active"),(0,_jquery.default)(".step-1").removeClass("completed"),(0,_jquery.default)(".step-2").removeClass("active")})),(0,_jquery.default)(document).on("click",".stage-b",(function(){let organization=(0,_jquery.default)("#id_organization").val(),organizationcode=(0,_jquery.default)("#id_organization_code").val(),name=(0,_jquery.default)("#id_name").val(),email=(0,_jquery.default)("#id_email").val();""===organization||""===organizationcode||""===name||""===email?(0,_str.get_string)("requiredallfields","repository_zatuk").then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))})):isValidEmail(email)?((0,_jquery.default)(".section_container").addClass("d-none"),(0,_jquery.default)(".section_container.registration_plans").removeClass("d-none"),(0,_jquery.default)(".stage-form .section_container").removeClass("active"),(0,_jquery.default)(".stage-form .section_container").addClass("d-none"),(0,_jquery.default)(".step-1").addClass("completed"),(0,_jquery.default)(".step-2").addClass("active")):(0,_str.get_string)("validemailidrequired","repository_zatuk",email).then((str=>{MessageModal.confirmbox((0,_str.get_string)("failedwarningmessage","repository_zatuk",str))}))}))}}));

//# sourceMappingURL=configuration.min.js.map