{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Defines zatuk configuration script.\n *\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\nimport messagemodal from 'repository_zatuk/messagemodal';\nimport Templates from 'core/templates';\n\nconst Selectors = {\n    actions: {\n        zatuksettings: '[data-action=\"zatuksettings\"]',\n        zatukplans: '[data-action=\"zatukplans\"]',\n        zatukdetails: '[data-action=\"zatukdetails\"]',\n        updatesettings: '[data-action=\"updatesettings\"]',\n\n    },\n};\n\nlet MessageModal = new messagemodal();\n\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let zatuksettings = e.target.closest(Selectors.actions.zatuksettings);\n        if (zatuksettings) {\n            let organization = $(\"#id_organization\").val();\n            let organizationcode = $(\"#id_organization_code\").val();\n            let name = $(\"#id_name\").val();\n            let email = $(\"#id_email\").val();\n            e.preventDefault();\n            if(organization === '' || organizationcode === '' || name === '' ||  email === '' ) {\n                getString('requiredallfields' ,'repository_zatuk').then((str) => {\n                    MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            } else {\n                if (isValidEmail(email)) {\n                    $.ajax({\n                        method: \"GET\",\n                        dataType: \"json\",\n                        url: M.cfg.wwwroot + \"/repository/zatuk/ajax.php?organization=\"+organization+\n                        \"&organizationcode=\"+organizationcode+\n                        \"&name=\"+name+\n                        \"&email=\"+email+\"\",\n                        success: function(){\n                            $('.section_container').addClass('d-none');\n                            $('.section_container.registration_plans').removeClass('d-none');\n                            $('.step-1').addClass('completed');\n                            $('.step-2').addClass('active');\n                        }\n                    });\n\n                } else {\n                    getString('validemailidrequired', 'repository_zatuk', email).then((str) => {\n                        MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                    });\n                }\n\n            }\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukplans = e.target.closest(Selectors.actions.zatukplans);\n        if (zatukplans) {\n            e.preventDefault();\n            Templates.render('repository_zatuk/loader', {}).then(function(html, js) {\n              Templates.appendNodeContents('#page-content', html, js);\n            });\n            var organization = $(\"#id_organization\").val();\n            var organizationcode = $(\"#id_organization_code\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            var params = {};\n            params.organization = organization;\n            params.organizationcode = organizationcode;\n            params.name = name;\n            params.email = email;\n            var promise = Ajax.call([{\n                methodname: 'repository_configure_zatuk',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                if(resp.success) {\n                     var params = {};\n                     params.haskeygenerated = resp.success;\n                    var promise = Ajax.call([{\n                        methodname: 'repository_enable_zatuk',\n                        args : params\n                    }]);\n                    promise[0].done(function(enbresponse) {\n                        if (enbresponse.success) {\n                            $('.zatuk-page-loader').addClass('d-none');\n                            getString('freetrailmessage' ,'repository_zatuk').then((str) => {\n                                MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                            });\n                            $(\".secret_keys\").load(location.href + \" .secret_keys\");\n                            $('.section_container').addClass('d-none');\n                            $('.section_container.registration_keys').removeClass('d-none');\n                            $('.step-2').addClass('completed');\n                            $('.step-3').addClass('active');\n                        } else {\n                            $('.zatuk-page-loader').addClass('d-none');\n                            getString('keysecretnotgenerated', 'repository_zatuk').then((str) => {\n                               MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                            });\n                        }\n                    }).fail(function() {\n                        $('.zatuk-page-loader').addClass('d-none');\n                        getString('errormessage', 'repository_zatuk').then((str) => {\n                           MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    });\n\n                } else {\n                    if(resp.message.length > 2) {\n                        $('.zatuk-page-loader').addClass('d-none');\n                        MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',resp.message));\n\n                    } else {\n                        $('.zatuk-page-loader').addClass('d-none');\n                        getString('serverdown' ,'repository_zatuk').then((str) => {\n                          MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    }\n                }\n            }).fail(function() {\n                $('.zatuk-page-loader').addClass('d-none');\n                getString('errormessage', 'repository_zatuk').then((str) => {\n                  MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            });\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukdetails = e.target.closest(Selectors.actions.zatukdetails);\n        if (zatukdetails) {\n            window.addEventListener('beforeunload', function (event) {\n                event.stopImmediatePropagation();\n            });\n            window.location.reload();\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let updatesettings = e.target.closest(Selectors.actions.updatesettings);\n        if (updatesettings) {\n            e.preventDefault();\n            var params = {};\n            var organization = $(\"#id_organization\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            if(organization === '' || name === '' ||  email === '' ) {\n                getString('requiredallfields' ,'repository_zatuk').then((str) => {\n                    MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            } else {\n                if (isValidEmail(email)) {\n                    var params = {};\n                    params.organization = organization;\n                    params.name = name;\n                    params.email = email;\n                    var promise = Ajax.call([{\n                        methodname: 'repository_update_zatuk_settings',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.success) {\n                            getString('updatemessage' ,'repository_zatuk').then((str) => {\n                                MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                            });\n                        }\n                    }).fail(function() {\n                       getString('errormessage', 'repository_zatuk').then((str) => {\n                            MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    });\n\n                } else {\n                    getString('validemailidrequired', 'repository_zatuk', email).then((str) => {\n                        MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                    });\n                }\n\n            }\n\n        }\n    });\n\n    $(document).on('click','.stage-a', function(){\n\n        $('.section_container').removeClass('d-none');\n\n        $('.section_container.registration_plans').addClass('d-none');\n\n        $('.section_container.registration_keys').addClass('d-none');\n\n        $('.stage-form .section_container').addClass('active');\n\n        $('.step-1').removeClass(\"completed\");\n\n        $('.step-2').removeClass('active');\n\n\n    });\n\n    $(document).on('click','.stage-b', function(){\n\n        let organization = $(\"#id_organization\").val();\n        let organizationcode = $(\"#id_organization_code\").val();\n        let name = $(\"#id_name\").val();\n        let email = $(\"#id_email\").val();\n\n         if(organization === '' || organizationcode === '' || name === '' ||  email === '' ) {\n\n            getString('requiredallfields' ,'repository_zatuk').then((str) => {\n                MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n            });\n\n        } else {\n\n            if (isValidEmail(email)) {\n                $('.section_container').addClass('d-none');\n                $('.section_container.registration_plans').removeClass('d-none');\n                $('.stage-form .section_container').removeClass('active');\n                $('.stage-form .section_container').addClass('d-none');\n\n                $('.step-1').addClass('completed');\n                $('.step-2').addClass('active');\n\n            } else {\n                getString('validemailidrequired', 'repository_zatuk', email).then((str) => {\n                    MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            }\n\n        }\n\n    });\n\n    /**\n     * Function to validate an email address.\n     * @param {string} inputval - an email.\n     */\n    function isValidEmail(inputval) {\n        const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n        return regex.test(inputval);\n    }\n\n};\n\n\n"],"names":["Selectors","zatuksettings","zatukplans","zatukdetails","updatesettings","MessageModal","messagemodal","isValidEmail","inputval","test","document","addEventListener","e","target","closest","organization","val","organizationcode","name","email","preventDefault","then","str","confirmbox","ajax","method","dataType","url","M","cfg","wwwroot","success","addClass","removeClass","render","html","js","appendNodeContents","params","Ajax","call","methodname","args","done","resp","haskeygenerated","enbresponse","load","location","href","fail","message","length","window","event","stopImmediatePropagation","reload","on"],"mappings":"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"}