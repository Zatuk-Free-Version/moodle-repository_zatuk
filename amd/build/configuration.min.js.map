{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Defines zatuk configuration script.\n *\n * @since      Moodle 2.0\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\nimport messagemodal from 'repository_zatuk/messagemodal';\n\nconst Selectors = {\n    actions: {\n        zatuksettings: '[data-action=\"zatuksettings\"]',\n        zatukplans: '[data-action=\"zatukplans\"]',\n        zatukdetails: '[data-action=\"zatukdetails\"]',\n        updatesettings: '[data-action=\"updatesettings\"]',\n\n    },\n};\n\nlet MessageModal = new messagemodal();\n\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let zatuksettings = e.target.closest(Selectors.actions.zatuksettings);\n        if (zatuksettings) {\n            e.preventDefault();\n            $('.section_container').addClass('d-none');\n            $('.section_container.registration_plans').removeClass('d-none');\n            $('.step-1').addClass('completed');\n            $('.step-2').addClass('active');\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukplans = e.target.closest(Selectors.actions.zatukplans);\n        if (zatukplans) {\n            e.preventDefault();\n            var params = {};\n            var organization = $(\"#id_organization\").val();\n            var zatuk_api_url = $(\"#id_zatuk_api_url\").val();\n            var organisationcode = $(\"#id_organization_code\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            var params = {};\n            params.organization = organization;\n            params.zatuk_api_url = zatuk_api_url;\n            params.organisationcode = organisationcode;\n            params.name = name;\n            params.email = email;\n            var promise = Ajax.call([{\n                methodname: 'repository_zatukplans',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                if(resp.success) {\n                    var params = {};\n                    params.value = null;\n                    var promise = Ajax.call([{\n                        methodname: 'repository_enable_zatuk',\n                        args: params\n                    }]);\n                    promise[0].done(function() {\n                        getString('freetrailmessage' ,'repository_zatuk').then((str) => {\n                            MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                        });\n                        $(\".secret_keys\").load(location.href + \" .secret_keys\");\n                        $('.section_container').addClass('d-none');\n                        $('.section_container.registration_keys').removeClass('d-none');\n                        $('.step-2').addClass('completed');\n                        $('.step-3').addClass('active');\n                    }).fail(function() {\n                        MessageModal.confirmbox(getString('exception'));\n                    });\n\n                } else {\n                    if(resp.errormessage === null && resp.success === null) {\n                        MessageModal.confirmbox(getString('serverdown', 'repository_zatuk'));\n                    } else {\n                        MessageModal.confirmbox(resp.errormessage);\n                    }\n                }\n            }).fail(function() {\n                MessageModal.confirmbox(getString('errormessage', 'repository_zatuk'));\n            });\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukdetails = e.target.closest(Selectors.actions.zatukdetails);\n        if (zatukdetails) {\n            e.preventDefault();\n            location.reload();\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let updatesettings = e.target.closest(Selectors.actions.updatesettings);\n        if (updatesettings) {\n            e.preventDefault();\n            var params = {};\n            var organization = $(\"#id_organization\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            var params = {};\n            params.organization = organization;\n            params.name = name;\n            params.email = email;\n            var promise = Ajax.call([{\n                methodname: 'repository_updatezatuksettings',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                if(resp) {\n                    getString('updatemessage' ,'repository_zatuk').then((str) => {\n                        MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                    });\n                }\n            }).fail(function() {\n                MessageModal.confirmbox('exception');\n            });\n        }\n    });\n};\n\n\n"],"names":["Selectors","zatuksettings","zatukplans","zatukdetails","updatesettings","MessageModal","messagemodal","document","addEventListener","e","target","closest","preventDefault","addClass","removeClass","params","organization","val","zatuk_api_url","organisationcode","name","email","Ajax","call","methodname","args","done","resp","success","then","str","confirmbox","load","location","href","fail","errormessage","reload"],"mappings":";;;;;;;wNA2BMA,kBACO,CACLC,cAAe,gCACfC,WAAY,6BACZC,aAAc,+BACdC,eAAgB,sCAKpBC,aAAe,IAAIC,oCAEH,KAChBC,SAASC,iBAAiB,SAAS,SAASC,GACpBA,EAAEC,OAAOC,QAAQX,kBAAkBC,iBAEnDQ,EAAEG,qCACA,sBAAsBC,SAAS,8BAC/B,yCAAyCC,YAAY,8BACrD,WAAWD,SAAS,iCACpB,WAAWA,SAAS,cAG9BN,SAASC,iBAAiB,SAAS,SAASC,MACvBA,EAAEC,OAAOC,QAAQX,kBAAkBE,YACpC,CACZO,EAAEG,qBACEG,OAAS,GACTC,cAAe,mBAAE,oBAAoBC,MACrCC,eAAgB,mBAAE,qBAAqBD,MACvCE,kBAAmB,mBAAE,yBAAyBF,MAC9CG,MAAO,mBAAE,YAAYH,MACrBI,OAAQ,mBAAE,aAAaJ,OACvBF,OAAS,IACNC,aAAeA,aACtBD,OAAOG,cAAgBA,cACvBH,OAAOI,iBAAmBA,iBAC1BJ,OAAOK,KAAOA,KACdL,OAAOM,MAAQA,MACDC,cAAKC,KAAK,CAAC,CACrBC,WAAY,wBACZC,KAAMV,UAEF,GAAGW,MAAK,SAASC,SAClBA,KAAKC,QAAS,KACTb,OAAS,CACbA,MAAe,MACDO,cAAKC,KAAK,CAAC,CACrBC,WAAY,0BACZC,KAAMV,UAEF,GAAGW,MAAK,+BACF,mBAAoB,oBAAoBG,MAAMC,MACpDzB,aAAa0B,YAAW,mBAAU,oBAAoB,mBAAmBD,6BAE3E,gBAAgBE,KAAKC,SAASC,KAAO,qCACrC,sBAAsBrB,SAAS,8BAC/B,wCAAwCC,YAAY,8BACpD,WAAWD,SAAS,iCACpB,WAAWA,SAAS,aACvBsB,MAAK,WACJ9B,aAAa0B,YAAW,mBAAU,sBAIb,OAAtBJ,KAAKS,cAA0C,OAAjBT,KAAKC,QAClCvB,aAAa0B,YAAW,mBAAU,aAAc,qBAEhD1B,aAAa0B,WAAWJ,KAAKS,iBAGtCD,MAAK,WACJ9B,aAAa0B,YAAW,mBAAU,eAAgB,4BAI9DxB,SAASC,iBAAiB,SAAS,SAASC,GACrBA,EAAEC,OAAOC,QAAQX,kBAAkBG,gBAElDM,EAAEG,iBACFqB,SAASI,aAGjB9B,SAASC,iBAAiB,SAAS,SAASC,MACnBA,EAAEC,OAAOC,QAAQX,kBAAkBI,gBACpC,CAChBK,EAAEG,qBACEG,OAAS,GACTC,cAAe,mBAAE,oBAAoBC,MACrCG,MAAO,mBAAE,YAAYH,MACrBI,OAAQ,mBAAE,aAAaJ,OACvBF,OAAS,IACNC,aAAeA,aACtBD,OAAOK,KAAOA,KACdL,OAAOM,MAAQA,MACDC,cAAKC,KAAK,CAAC,CACrBC,WAAY,iCACZC,KAAMV,UAEF,GAAGW,MAAK,SAASC,MAClBA,0BACW,gBAAiB,oBAAoBE,MAAMC,MACjDzB,aAAa0B,YAAW,mBAAU,oBAAoB,mBAAmBD,YAGlFK,MAAK,WACJ9B,aAAa0B,WAAW"}