{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Defines zatuk configuration script.\n *\n * @copyright  2023 Moodle India\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\nimport messagemodal from 'repository_zatuk/messagemodal';\n\nconst Selectors = {\n    actions: {\n        zatuksettings: '[data-action=\"zatuksettings\"]',\n        zatukplans: '[data-action=\"zatukplans\"]',\n        zatukdetails: '[data-action=\"zatukdetails\"]',\n        updatesettings: '[data-action=\"updatesettings\"]',\n\n    },\n};\n\nlet MessageModal = new messagemodal();\n\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let zatuksettings = e.target.closest(Selectors.actions.zatuksettings);\n\n        if (zatuksettings) {\n\n            let organization = $(\"#id_organization\").val();\n            let zatukapiurl = $(\"#id_zatukapiurl\").val();\n            let organizationcode = $(\"#id_organization_code\").val();\n            let name = $(\"#id_name\").val();\n            let email = $(\"#id_email\").val();\n            e.preventDefault();\n            if(organization === '' || organizationcode === '' || zatukapiurl === '' || name === '' ||  email === '' ) {\n                getString('requiredallfields' ,'repository_zatuk').then((str) => {\n                    MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            } else {\n                $.ajax({\n                    method: \"GET\",\n                    dataType: \"json\",\n                    url: M.cfg.wwwroot + \"/repository/zatuk/ajax.php?organization=\"+organization+\n                    \"&zatukapiurl=\"+zatukapiurl+\n                    \"&organizationcode=\"+organizationcode+\n                    \"&name=\"+name+\n                    \"&email=\"+email+\"\",\n                    success: function(){\n                        $('.section_container').addClass('d-none');\n                        $('.section_container.registration_plans').removeClass('d-none');\n                        $('.step-1').addClass('completed');\n                        $('.step-2').addClass('active');\n                    }\n                });\n\n            }\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukplans = e.target.closest(Selectors.actions.zatukplans);\n        if (zatukplans) {\n            e.preventDefault();\n            var params = {};\n            var organization = $(\"#id_organization\").val();\n            var zatukapiurl = $(\"#id_zatukapiurl\").val();\n            var organizationcode = $(\"#id_organization_code\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            var params = {};\n            params.organization = organization;\n            params.zatukapiurl = zatukapiurl;\n            params.organizationcode = organizationcode;\n            params.name = name;\n            params.email = email;\n            var promise = Ajax.call([{\n                methodname: 'repository_configure_zatuk',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                if(resp.success) {\n                    var params = {};\n                    params.value = null;\n                    var promise = Ajax.call([{\n                        methodname: 'repository_enable_zatuk',\n                        args: params\n                    }]);\n                    promise[0].done(function() {\n                        getString('freetrailmessage' ,'repository_zatuk').then((str) => {\n                            MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                        });\n                        $(\".secret_keys\").load(location.href + \" .secret_keys\");\n                        $('.section_container').addClass('d-none');\n                        $('.section_container.registration_keys').removeClass('d-none');\n                        $('.step-2').addClass('completed');\n                        $('.step-3').addClass('active');\n                    }).fail(function() {\n                        getString('exception', 'repository_zatuk').then((str) => {\n                           MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    });\n\n                } else {\n                    if(resp.errormessage === null && resp.success === null) {\n                        getString('serverdown' ,'repository_zatuk').then((str) => {\n                          MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    } else {\n                        getString(resp.errormessage).then((str) => {\n                          MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                        });\n                    }\n                }\n            }).fail(function() {\n                getString('errormessage', 'repository_zatuk').then((str) => {\n                  MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            });\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let zatukdetails = e.target.closest(Selectors.actions.zatukdetails);\n        if (zatukdetails) {\n            e.preventDefault();\n            $(window).off('beforeunload');\n            window.location.reload();\n        }\n    });\n    document.addEventListener('click', function(e) {\n        let updatesettings = e.target.closest(Selectors.actions.updatesettings);\n        if (updatesettings) {\n            e.preventDefault();\n            var params = {};\n            var organization = $(\"#id_organization\").val();\n            var name = $(\"#id_name\").val();\n            var email = $(\"#id_email\").val();\n            if(organization === '' || name === '' ||  email === '' ) {\n                getString('requiredallfields' ,'repository_zatuk').then((str) => {\n                    MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                });\n            } else {\n                var params = {};\n                params.organization = organization;\n                params.name = name;\n                params.email = email;\n                var promise = Ajax.call([{\n                    methodname: 'repository_update_zatuk_settings',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    if(resp) {\n                        getString('updatemessage' ,'repository_zatuk').then((str) => {\n                            MessageModal.confirmbox(getString('finaltrailmessage','repository_zatuk',str));\n                        });\n                    }\n                }).fail(function() {\n                   getString('exception', 'repository_zatuk').then((str) => {\n                        MessageModal.confirmbox(getString('failedwarningmessage','repository_zatuk',str));\n                    });\n                });\n            }\n\n        }\n    });\n};\n\n\n"],"names":["Selectors","zatuksettings","zatukplans","zatukdetails","updatesettings","MessageModal","messagemodal","document","addEventListener","e","target","closest","organization","val","zatukapiurl","organizationcode","name","email","preventDefault","then","str","confirmbox","ajax","method","dataType","url","M","cfg","wwwroot","success","addClass","removeClass","params","Ajax","call","methodname","args","done","resp","load","location","href","fail","errormessage","window","off","reload"],"mappings":"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"}